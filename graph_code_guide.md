# Graph CoffeeScript Code Style Guide

Сначала перед чтением руководства необходимо прочитать:

 * [CoffeeScript Code Style Guide](code-guide.md) - чтобы составить общее представление о code style (обязательно)
 * [Правила оформления контент-комитов](content-commits.md) (обязательно)
 * [Content. Update Script.](update_script.md) (опционально)
 * [Процессы разработки контента](content-2.md) - новая графовая система разработки контента (обязательно)

Можно не читать вышеприведенные ссылки, но тогда картина мира будет неполной, и все, о чем речь пойдет ниже, вряд ли будет понятно.

Основные требования к стилю кода остаются прежние: имена переменных, правила для css файлов, имена методов и т.д. - все правила в силе.

## Что изменилось после введения графовой системы:

* Список файлов карточки
(добавился файл графа, файл скрипта пишется по-другому, файл стилей теперь не один)
* Рыба карточки
* SBS репорты писать не нужно - теперь генерируются автоматически
* Общие принципы написания js файла


### Список файлов карточки

Теперь нулевой этап начала работы с новой карточкой - составление графа в файле с расширением ``` *.graph```.

**Важно!** Файл графа должен иметь имя, совпадающее с именем js файла скрипта. Например, 422.script и 422.graph

**Важно!** Именование json файла (карточки и скрипта) остается строгим - ```ID_script.json``` (для json скрипта), где ```ID``` - номер скрипта.
 
**Важно!** (changelog от 11.07.14) Xорошо называть граф `123.graph` и рядом класть `123.js.coffee` - теперь рядом можно еще положить 123.json - это будет мета скрипта `#123`. Для карточек остался старый формат `56_card.json`. Таким образом, для скриптов теперь 2 формата: `123_script.json` (старый), `123.json` (новый)
 
CSS файл скрипта теперь не один большой, а много маленьких, разбитых по смысловым блокам.

#### Правила для css файлов

+ оборачивать правила неймспейсом `&` нужно, если у вас в файле подключена только примесь, если нет - то `&` необязателен.

#### Правила для js файлов

+ В большинстве своем правил немного (почти нет) если вы грамотно и вовремя запускаете ```./update_script ID```, где ```ID``` - номер скрипта.

### Итоговый список файлов

+ `script_ID.json` (формат не изменился)

+ `ID.js.coffee` где `ID` - номер скрипта,выделенного системой (см. [CoffeeScript Code Style Guide](code-guide.md))

+ `name.js.coffee` (формат поменялся, пример ниже, количество в карточке может быть от 1 до бесконечности)

+ `name.graph` (совершенно новый тип файла)

+ `cardID_card.json` (формат не изменился, `cardID` - номер карточки)

+ `*.css.scss` (формат почти не поменялся, количество в карточке может быть от 0 до бесконечности)


### Workflow работы с вьювером

1. Запускаем в консоли из папки `content` файл `run` - приложение вьювера

2. Если были в канале #dev описаны какие-либо изменения:

    2.1 Взять изменения с сервера `git pull --rebase`

    2.2 Если специально оговорено в канале, нужно сделать команды `cd viewer` и  `bundle install`

    2.3 Перезапустить вьювер из консоли - завершить `Ctrl+C`

    2.4 Перейти к шагу 1
       
       
### Рыба карточки

Напомним, json имеет вид

```coffeescript
{
  "name": "card_name",
  "require": [
    "/components/kernel",
    "123.graph",
    "script_123.js"
  ],
  "lang": {
    "ru": {
    },
    "en": {
    }
  }
}
```

graph файл

```coffeescript
(script_123)-->
the_end()
```

Файл карточки (json) такой же:

```coffeescript
{
  "name_ru": "Название карточки на русском языке как она названа в cms",
  "progress": "beads",
  "require": [
    "/components/_player_v1"
  ],
  "chunks": [
     {
        "script": 123,
        "amount": 1,
        "strategy": "stack",
        "generations": [
          {
          }
        ]
     }
  ]
}
```

Файл скрипта можно оставить пустым. (так как нет никаких шагов, карточка запустилась и закончилась)

**Важно!** Формат точки входа в граф (первая строчка в файле 123.graph) должна выглядеть именно так - `script_id`, где `id` - id скрипта, выделенного системой.

## Changelog

2014.07.04
- Добавлена рыба руководства

2014.07.11
- Добавлена информация о небольших изменениях в именах некоторых файлов
- Добавлена рыба карточки
